services:
  pwd-gen:
    build:
      context: .
      dockerfile: Dockerfile
    image: redmine-password-packer:local
    container_name: redmine-pwd-packer
    environment:
      # Configuration file path (mount config.yml as volume)
      - CONFIG_YAML=/app/config.yml
    volumes:
      # Main configuration file (read-only)
      - ./config.yml:/app/config.yml:ro
      # Output directory for results
      - ./output:/app/output
      # Application code
      - ./app:/app
      # Entrypoint script (read-only)
      - ./entrypoint.sh:/app/entrypoint.sh:ro
    # Run main processing by default
    entrypoint: ["python", "main.py"]

  pwd-gen-test:
    image: redmine-password-packer:local
    container_name: redmine-pwd-packer-test
    environment:
      - CONFIG_YAML=/app/config.yml
    volumes:
      - ./config.yml:/app/config.yml:ro
      - ./output:/app/output
      - ./app:/app
      - ./entrypoint.sh:/app/entrypoint.sh:ro
    entrypoint: ["python", "test_runner.py"]
